<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vision Microservice at Scale — Case Study — Nirav Ramidi</title>
  <meta name="description" content="CNN-OCR microservice on Docker/Kubernetes with p95 < 300 ms at ~1k req/s and ~0.2% error in load tests. Production hardening, autoscaling, and monitoring." />

  <!-- Styles (kept separate) -->
  <link rel="stylesheet" href="../../../assets/css/main.css" />
  <link rel="icon" href="../../../assets/img/favicon.png" />

  <!-- Optional structured data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareSourceCode",
    "name":"Vision Microservice at Scale",
    "author":{"@type":"Person","name":"Nirav Ramidi"},
    "programmingLanguage":"Python",
    "runtimePlatform":"Docker/Kubernetes",
    "keywords":"Computer vision, OCR, FastAPI, Docker, Kubernetes, Autoscaling, Monitoring"
  }
  </script>
</head>

<body>
  <a class="skip-link" href="#content">Skip to content</a>

  <!-- Header / Nav -->
  <header class="site-header" role="banner">
    <div class="container header-inner">
      <a class="brand" href="../../../" aria-label="Nirav Ramidi — home">
        <span class="brand__mark" aria-hidden="true">NR</span>
        <span class="brand__text">Nirav Ramidi</span>
      </a>

      <nav class="site-nav" aria-label="Primary">
        <ul class="nav-list">
          <li><a href="../../../">Home</a></li>
          <li><a href="../../../experience.html">Experience</a></li>
          <li><a href="../../">Projects</a></li>
          <li><a href="../../../writing/">Writing</a></li>
          <li><a href="../../../education/">Education</a></li>
          <li><a href="../../../about.html">About</a></li>
          <li class="hide-on-mobile"><a href="../../../resume/" class="btn btn--ghost">Resume</a></li>
          <li class="nav-icons">
            <a href="https://github.com/Nirav01" target="_blank" rel="noopener" aria-label="GitHub">GitHub</a>
            <a href="https://www.linkedin.com/in/nirav-ramidi/" target="_blank" rel="noopener" aria-label="LinkedIn">LinkedIn</a>
          </li>
        </ul>
      </nav>

      <a href="../../../resume/Nirav_Ramidi_CV.pdf" class="btn btn--primary show-on-mobile">Download CV</a>
    </div>
  </header>

  <main id="content" class="site-main" role="main">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs container" aria-label="Breadcrumb">
      <ol>
        <li><a href="../../../">Home</a></li>
        <li><a href="../../">Projects</a></li>
        <li><a href="../">Cloud / SRE</a></li>
        <li><span aria-current="page">Vision Microservice at Scale</span></li>
      </ol>
    </nav>

    <!-- Hero -->
    <section class="case-hero section">
      <div class="container case-hero__inner">
        <div class="case-hero__copy">
          <h1>Vision Microservice at Scale</h1>
          <p class="lead">
            Productionised a <strong>CNN-OCR</strong> pipeline behind a <strong>FastAPI</strong> service on
            <strong>Docker/Kubernetes</strong> with <strong>p95 &lt; 300&nbsp;ms</strong> latency at ~<strong>1,000 req/s</strong>
            and ~<strong>0.2%</strong> error in load tests.
          </p>
          <ul class="metrics">
            <li class="chip">FastAPI</li>
            <li class="chip">Docker · K8s</li>
            <li class="chip">p95 &lt; 300 ms</li>
            <li class="chip">~1k req/s</li>
            <li class="chip">~0.2% error</li>
          </ul>
        </div>
        <figure class="case-hero__media">
          <img src="../../../assets/img/case-studies/vision-hero.jpg" alt="High-level architecture of a computer-vision microservice on Kubernetes" loading="lazy" />
        </figure>
      </div>
    </section>

    <!-- Meta + Body -->
    <section class="case-layout section">
      <div class="container grid case-grid">

        <aside class="case-meta card">
          <h2 class="visually-hidden">Project info</h2>
          <dl class="meta-list">
            <dt>Org</dt><dd>iAssist Innovation Labs</dd>
            <dt>Role</dt><dd>Junior ML Engineer</dd>
            <dt>Duration</dt><dd>Apr 2024 – Sept 2024</dd>
            <dt>Focus</dt><dd>Production CV · SRE · Performance</dd>
            <dt>Stack</dt><dd>Python, FastAPI, Docker, Kubernetes, Redis, Prometheus/Grafana</dd>
            <dt>Links</dt>
            <dd>
              <ul class="bare">
                <li><a href="../../" aria-label="Back to projects">Back to Projects</a></li>
                <li><a href="../../../experience.html">Related experience</a></li>
              </ul>
            </dd>
          </dl>
        </aside>

        <article class="case-body">
          <!-- Problem -->
          <section class="case-section" id="problem">
            <h2>Problem &amp; Goals</h2>
            <p>
              Insurers receive large volumes of document images with variable quality (skew, blur, low resolution).
              We needed a reliable OCR pipeline with strict latency SLOs for mobile upload flows and back-office scans.
            </p>
            <ul>
              <li><strong>SLO:</strong> p95 &lt; 300 ms end-to-end for typical pages; &lt; 1% error rate under load.</li>
              <li><strong>Scale:</strong> bursty traffic patterns; sustain ~1k req/s in peak tests.</li>
              <li><strong>Reliability:</strong> graceful degradation for poor-quality inputs; clear error surfaces.</li>
            </ul>
          </section>

          <!-- Architecture -->
          <section class="case-section" id="architecture">
            <h2>Architecture</h2>
            <figure class="case-figure">
              <img src="../../../assets/img/case-studies/vision-architecture.png" alt="Gateway → API → Preprocess → Model → Postprocess → Result store; autoscaling on Kubernetes" loading="lazy" />
              <figcaption>Kubernetes deployment with a gateway, stateless API, and model workers.</figcaption>
            </figure>

            <div class="cols">
              <div>
                <h3>Request path</h3>
                <ol>
                  <li>Client uploads image → <em>Gateway</em> (ingress + auth).</li>
                  <li><em>FastAPI</em> validates, normalises (de-skew, resize), and routes to model worker.</li>
                  <li><em>Model worker</em> runs CNN text detection → OCR decode → post-processing.</li>
                  <li>Response returns extracted fields + confidence; traces/logs pushed asynchronously.</li>
                </ol>
              </div>
              <div>
                <h3>Key components</h3>
                <ul>
                  <li><strong>Containers:</strong> separate API and model images to slim cold starts.</li>
                  <li><strong>Caching:</strong> warm model weights; small LRU for frequent templates.</li>
                  <li><strong>Queue (optional):</strong> Redis for back-pressure during spikes.</li>
                  <li><strong>Config:</strong> env-driven; readiness/liveness probes; resource limits/requests.</li>
                </ul>
              </div>
            </div>
          </section>

          <!-- Performance -->
          <section class="case-section" id="performance">
            <h2>Performance &amp; Load Testing</h2>
            <ul class="checklist">
              <li>k6 load tests with mixed payloads (mobile scans, PDFs); open and closed-model phases.</li>
              <li>Achieved <strong>p95 &lt; 300 ms</strong> at ~<strong>1,000 req/s</strong> with ~<strong>0.2%</strong> HTTP 5xx/timeout.</li>
              <li>Removed micro-batching to reduce tail latency; optimised image I/O and pre-processing.</li>
              <li>Pinned CPU instruction set; used thread pools sized to <code>cores * 2</code> (empirical).</li>
            </ul>
            <figure class="case-figure">
              <img src="../../../assets/img/case-studies/vision-latency.png" alt="Latency histogram and p95 chart under load" loading="lazy" />
              <figcaption>Latency distribution under peak; tail kept under SLO with headroom.</figcaption>
            </figure>
          </section>

          <!-- Autoscaling & Resilience -->
          <section class="case-section" id="scaling">
            <h2>Autoscaling &amp; Resilience</h2>
            <div class="cols">
              <div>
                <h3>Autoscaling</h3>
                <ul>
                  <li>K8s HPA v2 on CPU and custom metric (requests in flight).</li>
                  <li>Pod disruption budgets; surge/availability tuned in rolling updates.</li>
                </ul>
                <h3>Resilience</h3>
                <ul>
                  <li>Retries with jitter on transient errors; circuit-breaker for downstreams.</li>
                  <li>Graceful shutdown: SIGTERM drains; in-flight requests complete.</li>
                </ul>
              </div>
              <div>
                <h3>Quality gates</h3>
                <ul>
                  <li>Pre-ingest checks: de-skew, min resolution, file-type whitelist.</li>
                  <li>Confidence thresholds and human-review flagging for low-quality pages.</li>
                </ul>
                <h3>Security</h3>
                <ul>
                  <li>Auth at gateway; signed URLs for uploads; PII scrubbing in logs.</li>
                </ul>
              </div>
            </div>
          </section>

          <!-- Observability -->
          <section class="case-section" id="observability">
            <h2>Monitoring &amp; Observability</h2>
            <ul>
              <li><strong>Metrics:</strong> RED/USE (rate, errors, duration / utilisation, saturation, errors); per-step timers.</li>
              <li><strong>Logging:</strong> structured JSON with correlation IDs; sensitive fields masked.</li>
              <li><strong>Tracing:</strong> request spans (ingress → API → model → store).</li>
              <li><strong>Dashboards:</strong> Grafana for SLOs, error budget burn, and capacity headroom.</li>
              <li><strong>Alerts:</strong> p95 &gt; 280 ms (warning), &gt; 300 ms (page); 5xx rate; queue depth.</li>
            </ul>
          </section>

          <!-- Results -->
          <section class="case-section" id="results">
            <h2>Results</h2>
            <ul class="checklist">
              <li>Met latency SLO (<strong>p95 &lt; 300 ms</strong>) at target throughput (~<strong>1k req/s</strong>).</li>
              <li>Reduced resubmissions via quality gates; improved first-time-right rates.</li>
              <li>Defined clear runbooks and dashboards for support teams.</li>
            </ul>
          </section>

          <!-- Lessons -->
          <section class="case-section" id="lessons">
            <h2>Lessons &amp; Next Steps</h2>
            <ul>
              <li>Tail latency hides in pre-processing and I/O; micro-batching isn’t always a win.</li>
              <li>Separate API/model images speed rollouts and keep cold starts predictable.</li>
              <li>Next: canary releases per model version; quantisation experiments; GPU pool evaluation.</li>
            </ul>
          </section>

          <!-- Footer nav -->
          <nav class="case-pager" aria-label="Case study pagination">
            <a class="btn btn--ghost" href="../swe-systems/twitter-cli.html">← Twitter-like CLI</a>
            <div class="spacer"></div>
            <a class="btn btn--secondary" href="queueing-capacity.html">Next: Queueing for Capacity Planning →</a>
          </nav>
        </article>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    <div class="container footer-inner">
      <p>© <span id="year">2025</span> Nirav Ramidi</p>
      <ul class="footer-links">
        <li><a href="https://github.com/Nirav01" target="_blank" rel="noopener">GitHub</a></li>
        <li><a href="https://www.linkedin.com/in/nirav-ramidi/" target="_blank" rel="noopener">LinkedIn</a></li>
        <li><a href="../../../resume/">Resume</a></li>
        <li><a href="../../../contact.html">Contact</a></li>
      </ul>
    </div>
  </footer>

  <!-- Scripts (kept separate) -->
  <script src="../../../assets/js/main.js" defer></script>
</body>
</html>
